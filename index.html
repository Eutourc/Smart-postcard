<script>
(function(){
  // —— 顺时针沿四周的步骤（只保留一个“针”）——
  // x/y 为百分比坐标；演示完会回到 index 0（邮票）
  const steps = [
    {name:'邮票',     x:76, y:18, text:'【邮票】：可自定义“邮票图案”。'},         // 右上
    {name:'优先/航空', x:62, y:18, text:'【航空/优先】：可选择是否加“优先/航空”。'},   // 上边
    {name:'邮戳',     x:73, y:27, text:'【邮戳】：选择纪念邮戳或常规邮戳。'},         // 右上偏下
    {name:'地址',     x:78, y:58, text:'【收件地址】：填写/导入收件人地址。'},        // 右侧中部
    {name:'城市地标', x:32, y:88, text:'【城市地标】：可更换城市地标图案。'},         // 下边偏左
    {name:'二维码',   x:16, y:83, text:'【二维码】：嵌入你的音/视频或位置链接。'},     // 左下
    {name:'说明栏',   x:22, y:18, text:'【说明栏】：可定制顶部标题/天气等信息。'}      // 左上
  ];

  const pin = document.getElementById('pin');        // 唯一的小箭头
  const info = document.getElementById('infotext');  // 说明文字
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const box  = document.getElementById('infobox');
  let i = 0;
  let demoTimer = null;
  let demoRunning = true; // 首次演示

  function render(){
    const s = steps[i];
    // 把唯一的小箭头移动到目标点
    pin.style.left = s.x + '%';
    pin.style.top  = s.y + '%';
    info.textContent = s.text;
  }
  function go(step){
    i = (i + step + steps.length) % steps.length;
    render();
  }

  // 左右箭头点击
  prev.addEventListener('click', ()=>{ stopDemo(); go(-1); });
  next.addEventListener('click', ()=>{ stopDemo(); go(1);  });

  // 在说明框里左右滑动也可切换
  let sx=0, dx=0;
  box.addEventListener('touchstart', e=>{ const t=e.touches[0]; if(!t) return; sx=t.clientX; dx=0; }, {passive:true});
  box.addEventListener('touchmove',  e=>{ const t=e.touches[0]; if(!t) return; dx=t.clientX - sx; }, {passive:true});
  box.addEventListener('touchend',   ()=>{
    if(Math.abs(dx) > 28){ stopDemo(); go(dx<0 ? 1 : -1); }
    sx=0; dx=0;
  });

  // —— 首次自动演示：顺时针绕一圈后回到邮票并停止 ——
  function startDemo(){
    let count = 0;
    demoTimer = setInterval(()=>{
      go(1);
      count++;
      if(count >= steps.length){ // 绕完一圈
        clearInterval(demoTimer);
        demoRunning = false;
        i = 0;       // 回到默认：邮票
        render();
      }
    }, 1100); // 每步 1.1s，节奏轻快
  }
  function stopDemo(){
    if(!demoRunning) return;
    clearInterval(demoTimer);
    demoRunning = false;
  }

  // 初始化：落位到邮票，再启动演示
  i = 0; render(); startDemo();

  // 更新时间戳（如你页面中存在 #lastUpdate）
  const d = new Date();
  const last = document.getElementById('lastUpdate');
  if(last) last.textContent = 'Last update: ' + d.toISOString().slice(0,10);
})();
</script>
