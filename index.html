<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Smart Postcard — v3.1i（纯注入 · base v3.0）</title>
<style>
  /* 仅新增 sp-*；不定义或覆盖任何非 sp- 的样式 */
  .sp-hint{position:absolute;left:50%;top:8px;transform:translateX(-50%);
    width:58%;min-height:72px;max-height:84px;padding:6px 10px;background:#fffef6;
    border:2px dashed #e7cf72;border-radius:12px;box-shadow:0 1px 6px rgba(231,207,114,.12);
    font:900 14px/1.26 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#222;
    text-align:center;overflow:hidden;z-index:9}
  .sp-hint .sp-line{display:block;margin:2px 0;white-space:nowrap}
  .sp-marker{position:absolute;width:0;height:0;border-left:13px solid transparent;border-right:13px solid transparent;border-top:16px solid #16a34a;filter:drop-shadow(0 2px 4px rgba(22,163,74,.35));z-index:10;pointer-events:none}
  .sp-ver{position:fixed;right:12px;bottom:96px;font:600 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#9e9e9e;pointer-events:none}
  @media (max-width:420px){ .sp-ver{ bottom:110px; } }
</style>
</head>
<body>

<!-- 保持页面其它结构由 v3.0 决定；此文件不写横幅/舞台样式 -->

<script>
(function(){
  // 找到 v3.0 的明信片容器（类名 .cardbox）
  const card = document.querySelector('.cardbox');
  if(!card) return;

  // 说明框
  const hint = document.createElement('div');
  hint.className = 'sp-hint';
  const lines = [
    "明信片背面图案！可成为邮票图案！",
    "您可以任选照片！可用您的自拍照！",
    "这等于洗了一张 A5 大尺码的照片！"
  ];
  hint.innerHTML = lines.map(t=>`<span class="sp-line">${t}</span>`).join("");

  // 自适应字号（12–16px）仅作用于 sp-hint
  const ctx = document.createElement('canvas').getContext('2d');
  const ff  = getComputedStyle(hint).fontFamily || 'system-ui';
  function fits(px){
    ctx.font = `900 ${px}px ${ff}`;
    const maxW = hint.clientWidth - 20;
    const maxH = parseFloat(getComputedStyle(hint).maxHeight) || 84;
    if(!lines.every(t => ctx.measureText(t).width <= maxW)) return false;
    const lh = (px>=15?1.26:1.24) * px;
    return lh * lines.length <= maxH;
  }
  let lo=12, hi=16, best=14;
  document.body.appendChild(hint); // 暂挂到 DOM 以获得尺寸
  while(lo<=hi){ const mid=(lo+hi>>1); if(fits(mid)){ best=mid; lo=mid+1; } else { hi=mid-1; } }
  hint.style.fontSize = best+'px'; hint.style.lineHeight = (best>=15?1.26:1.24);
  card.appendChild(hint);

  // 小箭头（默认指向邮票区域中心）
  const marker = document.createElement('div');
  marker.className = 'sp-marker';
  marker.style.left = '84%';
  marker.style.top  = 'calc(14% - 18px)';
  card.appendChild(marker);

  // 版本号（不参与布局；悬浮在视口右下角留白）
  const ver = document.createElement('div');
  ver.className = 'sp-ver';
  ver.textContent = 'v3.1i · base v3.0';
  document.body.appendChild(ver);
})();
</script>
</body>
</html>